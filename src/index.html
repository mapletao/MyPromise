<html>

<head>
    <meta charset="utf-8">
</head>

<body>
    <script src="myPromise.js"></script>
    <script>
        // const p2 = new Promise(function(resolve, reject) {
        //     reject(1)
        // })
        // const p5 = new Promise(function(resolve, reject) {
        //     resolve(2)
        // })
        // const p = new MyPromise(function(resolve, reject) {
        //     setTimeout(() => reject(1), 1000)
        // });
        // const p4 = new MyPromise(function(resolve, reject) {
        //     setTimeout(() => resolve(2), 1000)
        // });
        // const p3 = new MyPromise(function(resolve, reject) {
        //     reject(1)
        // });
        // const p6 = new MyPromise(function(resolve, reject) {
        //     resolve(2)
        // });
        // const p7 = Promise.resolve({
        //     then: function(resolve, reject) {
        //         resolve('p7')
        //     }
        // })
        // const p8 = MyPromise.resolve({
        //         then: function(resolve, reject) {
        //             resolve('p8')
        //         }
        //     })
        // test(p2, 'promise')
        // test(p5, 'promise')
        // test(p7, 'promise p7')
        // test(p8, 'MyPromise p8')
        // test2(p2, 'promise')
        // test(p, 'MyPromise')
        // test(p4, 'MyPromise')
        // test(p3, 'MyPromise')
        // test(p6, 'MyPromise')
        // test2(p, 'MyPromise')
        // Promise.resolve(function() {
        //     console.log(1)
        // }).then(res => {
        //     console.log('Promise.resolve', res)
        // });
        // MyPromise.resolve(function() {
        //     console.log(1)
        // }).then(res => {
        //     console.log('MyPromise.resolve', res)
        // });
        // testPromiseAll.bind(Promise)('Promise')
        // testPromiseAll.bind(MyPromise)('MyPromise')

        function testPromiseAll(str) {
            const p2 = this.resolve(new this(function(resolve) {
                setTimeout(() => {
                    resolve(6)
                }, 1000);
            }))
            this.all([this.resolve(1), this.resolve(2), this.resolve(3), p2])
                .then(res => {
                    console.log(str, res)
                }).catch(err => {
                    console.log(str, err)
                })
        }

        testRace.bind(Promise)('Promise')
        testRace.bind(MyPromise)('MyPromise')

        function testRace(str) {
            const p1 = this.resolve(new this(function(resolve, reject) {
                setTimeout(() => {
                    resolve(1)
                }, 100);
            }))
            const p2 = this.resolve(new this(function(resolve, reject) {
                setTimeout(() => {
                    resolve(6)
                }, 1000);
            }))
            const p3 = this.resolve(new this(function(resolve, reject) {
                setTimeout(() => {
                    resolve(7)
                }, 1500);
            }))
            const p4 = this.resolve(new this(function(resolve, reject) {
                setTimeout(() => {
                    resolve(8)
                }, 2000);
            }))
            this.race([this.reject(1), p1, p2, p3])
                .then(res => {
                    console.log(str, '*resolve*', res)
                }).catch(err => {
                    console.log(str, '*reject*', err)
                })
        }

        function test(p, text) {
            p.then(res => {
                console.log(text, res)
            }, err => {
                console.log(text, 'reject ' + err)
            }).then(res => {
                console.log(text, res)
            }).finally(() => {
                console.log(text, 'finally', p)
            })
        }

        function test2(p, text) {
            console.log(text)
            console.log(p.then())
            console.log(p.then().then())
        }
    </script>
</body>

</html>